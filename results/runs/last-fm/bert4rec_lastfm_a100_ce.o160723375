=== hostname ===
gadi-dgx-a100-0001.gadi.nci.org.au
=== PBS_JOBID ===
160723375.gadi-pbs
command line args [-m BERT4Rec -d lastfm --config_files configs/lastfm/lastfm_BERT4Rec.yaml] will not be used in RecBole
12 Feb 12:40    INFO  ['RecBole/run_recbole.py', '-m', 'BERT4Rec', '-d', 'lastfm', '--config_files', 'configs/lastfm/lastfm_BERT4Rec.yaml']
12 Feb 12:40    INFO  
General Hyper Parameters:
gpu_id = 0
use_gpu = True
seed = 2026
state = INFO
reproducibility = True
data_path = /scratch/up63/kd6504/recbole_datasets/lastfm
checkpoint_dir = outputs/bert4rec_lastfm
show_progress = False
save_dataset = False
dataset_save_path = None
save_dataloaders = False
dataloaders_save_path = None
log_wandb = False

Training Hyper Parameters:
epochs = 200
train_batch_size = 128
learner = adam
learning_rate = 0.001
train_neg_sample_args = {'distribution': 'none', 'sample_num': 'none', 'alpha': 'none', 'dynamic': False, 'candidate_num': 0}
eval_step = 1
stopping_step = 10
clip_grad_norm = None
weight_decay = 0.0
loss_decimal_place = 4

Evaluation Hyper Parameters:
eval_args = {'split': {'LS': 'valid_and_test'}, 'order': 'TO', 'group_by': 'user', 'mode': {'valid': 'full', 'test': 'full'}}
repeatable = True
metrics = ['Hit', 'NDCG', 'MRR']
topk = [1, 5, 10, 20]
valid_metric = NDCG@10
valid_metric_bigger = True
eval_batch_size = 4096
metric_decimal_place = 4

Dataset Hyper Parameters:
field_separator = 	
seq_separator =  
USER_ID_FIELD = user_id
ITEM_ID_FIELD = artist_id
RATING_FIELD = rating
TIME_FIELD = timestamp
seq_len = None
LABEL_FIELD = label
threshold = None
NEG_PREFIX = neg_
load_col = {'inter': ['user_id', 'artist_id', 'timestamp']}
unload_col = None
unused_col = None
additional_feat_suffix = None
rm_dup_inter = None
val_interval = None
filter_inter_by_user_or_item = True
user_inter_num_interval = [5,inf)
item_inter_num_interval = [5,inf)
alias_of_user_id = None
alias_of_item_id = None
alias_of_entity_id = None
alias_of_relation_id = None
preload_weight = None
normalize_field = None
normalize_all = None
ITEM_LIST_LENGTH_FIELD = item_length
LIST_SUFFIX = _list
MAX_ITEM_LIST_LENGTH = 50
POSITION_FIELD = position_id
HEAD_ENTITY_ID_FIELD = head_id
TAIL_ENTITY_ID_FIELD = tail_id
RELATION_ID_FIELD = relation_id
ENTITY_ID_FIELD = entity_id
benchmark_filename = None

Other Hyper Parameters: 
worker = 0
wandb_project = recbole
shuffle = True
require_pow = False
enable_amp = False
enable_scaler = False
transform = mask_itemseq
n_layers = 2
n_heads = 2
hidden_size = 64
inner_size = 256
hidden_dropout_prob = 0.2
attn_dropout_prob = 0.2
hidden_act = gelu
layer_norm_eps = 1e-12
initializer_range = 0.02
mask_ratio = 0.2
loss_type = CE
ft_ratio = 0.5
numerical_features = []
discretization = None
kg_reverse_r = False
entity_kg_num_interval = [0,inf)
relation_kg_num_interval = [0,inf)
MODEL_TYPE = ModelType.SEQUENTIAL
MODEL_INPUT_TYPE = InputType.POINTWISE
eval_type = EvaluatorType.RANKING
single_spec = True
local_rank = 0
device = cuda
valid_neg_sample_args = {'distribution': 'uniform', 'sample_num': 'none'}
test_neg_sample_args = {'distribution': 'uniform', 'sample_num': 'none'}


/home/572/kd6504/TRACT/RecBole/recbole/data/dataset/dataset.py:648: ChainedAssignmentError: A value is being set on a copy of a DataFrame or Series through chained assignment using an inplace method.
Such inplace method never works to update the original DataFrame or Series, because the intermediate object on which we are setting values always behaves as a copy (due to Copy-on-Write).

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' instead, to perform the operation inplace on the original object, or try to avoid an inplace operation using 'df[col] = df[col].method(value)'.

See the documentation for a more detailed explanation: https://pandas.pydata.org/pandas-docs/stable/user_guide/copy_on_write.html
  feat[field].fillna(value=0, inplace=True)
/home/572/kd6504/TRACT/RecBole/recbole/data/dataset/dataset.py:650: ChainedAssignmentError: A value is being set on a copy of a DataFrame or Series through chained assignment using an inplace method.
Such inplace method never works to update the original DataFrame or Series, because the intermediate object on which we are setting values always behaves as a copy (due to Copy-on-Write).

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' instead, to perform the operation inplace on the original object, or try to avoid an inplace operation using 'df[col] = df[col].method(value)'.

See the documentation for a more detailed explanation: https://pandas.pydata.org/pandas-docs/stable/user_guide/copy_on_write.html
  feat[field].fillna(value=feat[field].mean(), inplace=True)
12 Feb 12:40    INFO  lastfm
The number of users: 1091
Average actions of users: 48.21192660550459
The number of items: 3647
Average actions of items: 14.413329676357652
The number of inters: 52551
The sparsity of the dataset: 98.67925045182346%
Remain Fields: ['user_id', 'artist_id', 'timestamp']
/home/572/kd6504/TRACT/RecBole/recbole/data/dataset/dataset.py:2202: UserWarning: The given NumPy array is not writable, and PyTorch does not support non-writable tensors. This means writing to this tensor will result in undefined behavior. You may want to copy the array to protect its data or make it writable before converting it to a tensor. This type of warning will be suppressed for the rest of this program. (Triggered internally at /pytorch/torch/csrc/utils/tensor_numpy.cpp:203.)
  new_data[k] = torch.LongTensor(value)
12 Feb 12:40    INFO  [Training]: train_batch_size = [128] train_neg_sample_args: [{'distribution': 'none', 'sample_num': 'none', 'alpha': 'none', 'dynamic': False, 'candidate_num': 0}]
12 Feb 12:40    INFO  [Evaluation]: eval_batch_size = [4096] eval_args: [{'split': {'LS': 'valid_and_test'}, 'order': 'TO', 'group_by': 'user', 'mode': {'valid': 'full', 'test': 'full'}}]
12 Feb 12:40    INFO  BERT4Rec(
  (item_embedding): Embedding(3648, 64, padding_idx=0)
  (position_embedding): Embedding(50, 64)
  (trm_encoder): TransformerEncoder(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=64, out_features=64, bias=True)
          (key): Linear(in_features=64, out_features=64, bias=True)
          (value): Linear(in_features=64, out_features=64, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (dense): Linear(in_features=64, out_features=64, bias=True)
          (LayerNorm): LayerNorm((64,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (dense_1): Linear(in_features=64, out_features=256, bias=True)
          (dense_2): Linear(in_features=256, out_features=64, bias=True)
          (LayerNorm): LayerNorm((64,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (LayerNorm): LayerNorm((64,), eps=1e-12, elementwise_affine=True)
  (dropout): Dropout(p=0.2, inplace=False)
  (output_ffn): Linear(in_features=64, out_features=64, bias=True)
  (output_gelu): GELU(approximate='none')
  (output_ln): LayerNorm((64,), eps=1e-12, elementwise_affine=True)
)
Trainable parameters: 344703
12 Feb 12:40    INFO  FLOPs: 5194664.0
/home/572/kd6504/TRACT/RecBole/recbole/trainer/trainer.py:235: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = amp.GradScaler(enabled=self.enable_scaler)
12 Feb 12:41    INFO  epoch 0 training [time: 16.87s, train loss: 2989.9528]
12 Feb 12:41    INFO  epoch 0 evaluating [time: 0.10s, valid_score: 0.018300]
12 Feb 12:41    INFO  valid result: 
hit@1 : 0.0055    hit@5 : 0.022    hit@10 : 0.0339    hit@20 : 0.0596    ndcg@1 : 0.0055    ndcg@5 : 0.0146    ndcg@10 : 0.0183    ndcg@20 : 0.0248    mrr@1 : 0.0055    mrr@5 : 0.0121    mrr@10 : 0.0136    mrr@20 : 0.0154
12 Feb 12:41    INFO  Saving current: outputs/bert4rec_lastfm/BERT4Rec-Feb-12-2026_12-40-47.pth
12 Feb 12:41    INFO  epoch 1 training [time: 16.46s, train loss: 2816.1615]
12 Feb 12:41    INFO  epoch 1 evaluating [time: 0.07s, valid_score: 0.015800]
12 Feb 12:41    INFO  valid result: 
hit@1 : 0.0055    hit@5 : 0.0174    hit@10 : 0.0312    hit@20 : 0.0459    ndcg@1 : 0.0055    ndcg@5 : 0.0113    ndcg@10 : 0.0158    ndcg@20 : 0.0195    mrr@1 : 0.0055    mrr@5 : 0.0094    mrr@10 : 0.0113    mrr@20 : 0.0122
12 Feb 12:41    INFO  epoch 2 training [time: 16.60s, train loss: 2633.5878]
12 Feb 12:41    INFO  epoch 2 evaluating [time: 0.07s, valid_score: 0.026000]
12 Feb 12:41    INFO  valid result: 
hit@1 : 0.0064    hit@5 : 0.033    hit@10 : 0.0523    hit@20 : 0.0789    ndcg@1 : 0.0064    ndcg@5 : 0.0198    ndcg@10 : 0.026    ndcg@20 : 0.0327    mrr@1 : 0.0064    mrr@5 : 0.0155    mrr@10 : 0.018    mrr@20 : 0.0198
12 Feb 12:41    INFO  Saving current: outputs/bert4rec_lastfm/BERT4Rec-Feb-12-2026_12-40-47.pth
12 Feb 12:41    INFO  epoch 3 training [time: 16.58s, train loss: 2501.7696]
12 Feb 12:41    INFO  epoch 3 evaluating [time: 0.07s, valid_score: 0.029000]
12 Feb 12:41    INFO  valid result: 
hit@1 : 0.0092    hit@5 : 0.0367    hit@10 : 0.0569    hit@20 : 0.0862    ndcg@1 : 0.0092    ndcg@5 : 0.0224    ndcg@10 : 0.029    ndcg@20 : 0.0364    mrr@1 : 0.0092    mrr@5 : 0.0178    mrr@10 : 0.0205    mrr@20 : 0.0226
12 Feb 12:41    INFO  Saving current: outputs/bert4rec_lastfm/BERT4Rec-Feb-12-2026_12-40-47.pth
12 Feb 12:42    INFO  epoch 4 training [time: 16.46s, train loss: 2405.2291]
12 Feb 12:42    INFO  epoch 4 evaluating [time: 0.07s, valid_score: 0.027100]
12 Feb 12:42    INFO  valid result: 
hit@1 : 0.0064    hit@5 : 0.0321    hit@10 : 0.056    hit@20 : 0.0954    ndcg@1 : 0.0064    ndcg@5 : 0.0195    ndcg@10 : 0.0271    ndcg@20 : 0.0369    mrr@1 : 0.0064    mrr@5 : 0.0154    mrr@10 : 0.0184    mrr@20 : 0.0211
Traceback (most recent call last):
  File "/home/572/kd6504/TRACT/RecBole/run_recbole.py", line 46, in <module>
    run(
  File "/home/572/kd6504/TRACT/RecBole/recbole/quick_start/quick_start.py", line 52, in run
    res = run_recbole(
          ^^^^^^^^^^^^
  File "/home/572/kd6504/TRACT/RecBole/recbole/quick_start/quick_start.py", line 153, in run_recbole
    best_valid_score, best_valid_result = trainer.fit(
                                          ^^^^^^^^^^^^
  File "/home/572/kd6504/TRACT/RecBole/recbole/trainer/trainer.py", line 439, in fit
    train_loss = self._train_epoch(
                 ^^^^^^^^^^^^^^^^^^
  File "/home/572/kd6504/TRACT/RecBole/recbole/trainer/trainer.py", line 260, in _train_epoch
    self._check_nan(loss)
  File "/home/572/kd6504/TRACT/RecBole/recbole/trainer/trainer.py", line 346, in _check_nan
    raise ValueError("Training loss is nan")
ValueError: Training loss is nan
Job completed.

======================================================================================
                  Resource Usage on 2026-02-12 12:42:35:
   Job Id:             160723375.gadi-pbs
   Project:            up63
   Exit Status:        0
   Service Units:      2.20
   NCPUs Requested:    16                  CPU Time Used: 00:01:47        
   Memory Requested:   16.0GB                Memory Used: 1.05GB          
   NGPUs Requested:    1                 GPU Utilisation: 18%             
                                         GPU Memory Used: 1.03GB          
   Walltime Requested: 04:00:00            Walltime Used: 00:01:50        
   JobFS Requested:    100.0MB                JobFS Used: 5.03KB          
======================================================================================
